var is_redirected=0,idd="",id_ads="",tipo_ads="",pixel="ketoslimp",redirecionar=0,plataforma_parametro=["subacc","subacc2","subacc3","subacc4","clickid"],idVisita=null,ratoeira_status=1,qtd_cliques=3,urlRedirect="";function funcaoVisita(){var a=window.location.href,r=a.indexOf("?"),r=-1!==r?a.substring(0,r):a;if(0===ratoeira_status)console.warn("[ RATOEIRA DESATIVADA ]");else{a=new URLSearchParams(window.location.search);a.get("gclid")||a.get("msclkid")||a.get("fbclid");let t=0;a="ratoeira_"+r;localStorage.getItem(a)?(t=parseInt(localStorage.getItem(a)),t++,localStorage.setItem(a,t)):(localStorage.setItem(a,1),t=1),t&&(t>=qtd_cliques?callApi(1).then(a=>{null!==a&&(console.warn("[ VISITA REGISTRADA ]"),a.data.id?idVisita=a.data.id:a.data.track_id&&(idVisita=a.data.track_id),0==a.data?.google_bot)&&1==redirecionar&&(a=3*qtd_cliques,t<a?redirecionarComParametros(urlRedirect):console.log("nao vai redirecionar")),ajustarUrl(idVisita)}).catch(a=>{ajustarUrl(null)}):(localStorage.setItem(a,t),callApi(0).then(a=>{var t;null!==a&&(console.warn("[ VISITA REGISTRADA ]"),a.data.id?idVisita=a.data.id:a.data.track_id&&(idVisita=a.data.track_id),t=a.data?.is_bot,a=a.data?.google_bot,1==t)&&0==a&&1==redirecionar&&setTimeout(()=>{redirecionarComParametros(urlRedirect)},500),ajustarUrl(idVisita)}).catch(a=>{ajustarUrl(null)})))}}function callApi(a=0){try{var t=new URLSearchParams(window.location.search),r=(!pixel&&t.get("pixel")&&(pixel=t.get("pixel")),t.has("gclid")?tipo_ads="gclid":t.has("msclkid")?tipo_ads="msclkid":t.has("fbclid")&&(tipo_ads="fbclid"),new URLSearchParams(window.location.search)),e=(t.has("raads_source")&&(is_redirected=1),r.get("gclid")||r.get("msclkid")||r.get("fbclid")),i=r.get("wbraid")||r.get("gbraid"),o=(e?id_ads=e:i&&(id_ads=i,t.has("wbraid")?tipo_ads="wbraid":t.has("gbraid")&&(tipo_ads="gbraid")),{url:window.location.href,user_agent:window.navigator.userAgent,is_rato:a,trafego_pago:e||i?1:0,id_ads:e||id_ads,pixel:pixel||"NAO_INFORMADO",tipo_ads:tipo_ads,is_redirected:is_redirected,quantidade_visita:qtd_cliques}),d={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};return fetch("https://api.ratoeiraads.com.br/link-visita/978-513cf908-a244-439c-8659-4941914f5d08/visita",d).then(a=>a.json()).then(a=>a)}catch(a){console.error("An error occurred",a.message)}}function redirecionarComParametros(a){var t,r=plataforma_parametro.length;compareUrls(window.location.href,a)||(1<r&&(idVisita?(t="vst_"+idVisita,a=alterarParametro(plataforma_parametro[0],t,a),id_ads&&(a=alterarParametro(plataforma_parametro[1],id_ads,a)),plataforma_parametro[2]&&pixel&&(a=alterarParametro(plataforma_parametro[2],pixel,a))):(id_ads&&(a=alterarParametro(plataforma_parametro[0],id_ads,a)),pixel&&(a=alterarParametro(plataforma_parametro[1],pixel,a)))),1==r&&(idVisita?(t="vst_"+idVisita,a=alterarParametro(plataforma_parametro[0],t,a)):id_ads&&(a=alterarParametro(plataforma_parametro[0],id_ads,a))),tipo_ads&&id_ads&&(a=alterarParametro(tipo_ads,id_ads,a)),a=alterarParametro("raads_source","raads_redirect",a),console.log("novaUrl",a),window.location.href=a)}function compareUrls(a,t){var a=new URL(a),t=new URL(t),r=a.hostname.replace(/^www\./,""),e=t.hostname.replace(/^www\./,""),a=a.pathname.split("?")[0],t=t.pathname.split("?")[0];return r===e&&a===t}function ajustarUrl(e){for(var a=document.querySelectorAll("a"),t=0;t<a.length;t++){var r=a[t].getAttribute("href");r&&""!==r&&(r.startsWith("http://")||r.startsWith("https://")||r.startsWith("www."))&&(r=adicionarParametro(r,plataforma_parametro,e),a[t].setAttribute("href",r))}for(var i=document.querySelectorAll("button"),o=0;o<i.length;o++){var d=i[o].getAttribute("href");d&&""!==d&&(d.startsWith("http://")||d.startsWith("https://")||d.startsWith("www."))&&(d=adicionarParametro(d,plataforma_parametro,e),i[o].setAttribute("href",d))}document.querySelectorAll("form").forEach(r=>{plataforma_parametro.forEach(a=>{try{var t=document.createElement("input");t.type="hidden",t.name=a,t.value=e?"vst_"+e:id_ads||"",r.appendChild(t)}catch(a){console.error(a)}})})}function adicionarParametro(t,a,r){var e,i=a.length;return a&&0!=i?(r=null==r||""==r?id_ads:"vst_"+idVisita,idVisita?(a.forEach(a=>{t=alterarParametro(a,r,t)}),t=1<i&&id_ads&&(e=a[i-1])?alterarParametro(e,id_ads,t):t):tipo_ads?1<i?(r&&(t=alterarParametro(a[0],r,t)),t=pixel?alterarParametro(a[1],pixel,t):t):1==i&&r?alterarParametro(a[0],r,t):void 0:t):t}function alterarParametro(t,r,a){var a=a.split("#"),e=a[0],a=a[1]?"#"+a[1]:"",e=e.split("?"),i=e[1]?e[1].split("&"):[];let o=!1;for(let a=0;a<i.length;a++){var d=i[a].split("=");if(d[0]===t){d[1]=r,i[a]=d.join("="),o=!0;break}}return o||i.push(t+"="+r),e[0]+(0<i.length?"?"+i.join("&"):"")+a}document.addEventListener("click",function(a){var t,r=a.target.closest("a");console.log("linkParent",r),r&&(a.target,(t=r.href)&&("#"===t||t.startsWith("#"))?window.location.href=t:t!==window.location.href&&(a.preventDefault(),idVisita?(r={idVisita:idVisita,link:t},fetch("https://api.ratoeiraads.com.br/link-visita/978-513cf908-a244-439c-8659-4941914f5d08/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(a=>{window.location.href=t}).catch(a=>{window.location.href=t})):window.location.href=t))}),document.addEventListener("DOMContentLoaded",function(){funcaoVisita()});